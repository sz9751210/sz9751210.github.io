<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Kubernetes HPA：自動化應用擴展的藝術 | 艾倫的程式之旅</title>
<meta name=keywords content="kubernetes,k8s,k8s-hpa,hpa"><meta name=description content="k8s-hpa"><meta name=author content="Alan"><link rel=canonical href=https://sz9751210.github.io/posts/k8s-hpa/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.js onload=hljs.initHighlightingOnLoad()></script><link rel=icon href=https://sz9751210.github.io/assets/profile/avatar.png><link rel=icon type=image/png sizes=16x16 href=https://sz9751210.github.io/assets/profile/avatar.png><link rel=icon type=image/png sizes=32x32 href=https://sz9751210.github.io/assets/profile/avatar.png><link rel=apple-touch-icon href=https://sz9751210.github.io/assets/profile/avatar.png><link rel=mask-icon href=https://sz9751210.github.io/assets/profile/avatar.png><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-4RLTP9J7DY"></script><script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-4RLTP9J7DY",{anonymize_ip:!1})}</script><meta property="og:title" content="Kubernetes HPA：自動化應用擴展的藝術"><meta property="og:description" content="k8s-hpa"><meta property="og:type" content="article"><meta property="og:url" content="https://sz9751210.github.io/posts/k8s-hpa/"><meta property="og:image" content="https://sz9751210.github.io/assets/k8s-hpa/cover.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-01-03T16:09:00+08:00"><meta property="article:modified_time" content="2024-01-17T10:34:14+08:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://sz9751210.github.io/assets/k8s-hpa/cover.png"><meta name=twitter:title content="Kubernetes HPA：自動化應用擴展的藝術"><meta name=twitter:description content="k8s-hpa"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://sz9751210.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Kubernetes HPA：自動化應用擴展的藝術","item":"https://sz9751210.github.io/posts/k8s-hpa/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Kubernetes HPA：自動化應用擴展的藝術","name":"Kubernetes HPA：自動化應用擴展的藝術","description":"k8s-hpa","keywords":["kubernetes","k8s","k8s-hpa","hpa"],"articleBody":"引言 在當今的技術世界中，Kubernetes 已成為容器化應用的領導平台。作為一個高效的容器編排系統，它不僅管理著容器的部署和擴展，還提供了必要的自動化支持，以保證應用的高可用性和性能。在這個框架中，自動擴展功能起著至關重要的作用，特別是在面對不斷變化的負載和需求時。\n隨著企業和開發者尋求更靈活、更高效的資源管理方式，Kubernetes Horizontal Pod Autoscaler (HPA) 應運而生。HPA 是 Kubernetes 內建的一項機能，旨在自動調整 Pod 的數量以滿足當前的性能需求。這不僅提高了資源的使用效率，也確保了應用的穩定運行，特別是在高流量或不可預測的使用模式下。\nHPA 的核心價值在於其能夠基於實際的性能指標（如 CPU 利用率或自定義指標）動態調整 Pod 的數量。這種彈性的擴展機制意味著系統能夠自動應對突發流量，同時在需求降低時縮減資源，從而達到成本效益的最佳平衡。\nHorizontal Pod Autoscaler (HPA) 簡介 定義 Kubernetes Horizontal Pod Autoscaler，簡稱 HPA，是一種在 Kubernetes 環境中自動調整 Pod 數量的機制。它根據指定的指標（如 CPU 利用率、記憶體使用量或自定義指標）動態增減 Pod 的數量，以應對應用的負載變化。\n工作原理 當 HPA 被部署到 Kubernetes 集群時，它會定期（預設 15 秒）檢查所指定指標的當前值，來判斷是否需要擴展或縮減 Pod 的數量。當這些指標超過或低於預設的閾值時，HPA 會自動增加或減少 Pod 的數量，從而確保應用平穩運行。\n主要特點 動態擴展：根據實時的系統負載進行擴展或縮減。 靈活配置：支持多種指標，包括標準指標和自定義指標。 成本效益：通過優化資源使用，減少不必要的開支。 HPA的運作機制 指標類型 CPU 利用率：最常用的自動擴展指標。 自定義指標：根據特定的業務需求或性能指標進行擴展。 決策過程 HPA 決策過程基於預定的指標和閾值。當指標超過或低於設定的閾值時，HPA 會觸發擴展或縮減的操作。\n擴展策略 線性擴展：根據指標的增減比例進行擴展或縮減。 自定義策略：可以根據特定需求定制擴展策略。 HPA的設置與配置 基本設置步驟 確定指標：選擇用於自動擴展的指標，如 CPU 利用率或自定義指標。 部署 Metrics Server：安裝 Metrics Server 以提供必要的性能指標數據。 創建 HPA 資源：通過 Kubernetes 的 YAML 文件定義 HPA 資源，指定目標 Pod 和相應的擴展指標。 以下是一個使用 YAML 定義的 HPA 實例： apiVersion: autoscaling/v2beta2 kind: HorizontalPodAutoscaler metadata: name: myapp-hpa spec: scaleTargetRef: apiVersion: apps/v1 kind: Deployment name: myapp minReplicas: 1 maxReplicas: 10 metrics: - type: Resource resource: name: cpu target: type: Utilization averageUtilization: 50 在這個例子中，如果 myapp 的平均 CPU 使用率超過 50%，HPA 會自動增加 Pod 的數量，最多到 10 個副本。當 CPU 使用率下降時，HPA 則會減少 Pod 的數量，但不會少於 1 個副本。\n配置閾值：設置自動擴展的觸發閾值，如 CPU 利用率的最大和最小值。 配置選項 最小和最大 Pod 數：設定 Pod 的數量範圍。 擴展冷卻期：設定在進行下一次擴展之前的等待時間。 自定義指標：支持根據業務特定指標進行擴展。 常見問題和最佳實踐 確保 Metrics Server 正常運行。 避免設置過敏感的擴展閾值，以免造成頻繁的擴展操作。 根據應用需求和性能數據調整配置。 HPA的實際應用案例 在正式環境中，HPA 能夠為應用帶來顯著的彈性和效率提升。例如，電商網站在促銷期間可能會經歷流量高峰，這時 HPA 可以自動擴展服務以處理增加的請求。當促銷結束，流量減少，HPA 可以相應減少 Pod 的數量，節省資源。\n初始狀態（1 個 Pod 副本）:\nkubectl get po NAME READY STATUS RESTARTS AGE myapp-56f87c895f-9t7xx 1/1 Running 0 10m 流量增加後，HPA 自動擴展 Pod（例如增至 3 個副本）:\nkubectl get po NAME READY STATUS RESTARTS AGE myapp-56f87c895f-9t7xx 1/1 Running 0 12m myapp-56f87c895f-j7hk5 1/1 Running 0 2m myapp-56f87c895f-v9g8n 1/1 Running 0 2m 案例研究 電商平台：在促銷期間，根據流量自動調整服務器資源。 社交媒體應用：依據用戶活動高峰期動態調節後端服務。 效益分析 成本效益：通過僅在需要時增加資源，減少不必要的資源浪費。 提升性能：確保應用在高負載時仍能保持穩定性能。 自動化運維：減少人工介入，提高運維效率。 小結 Kubernetes HPA 是現代雲原生架構中不可或缺的一部分，它通過智能化的自動擴展機制，確保了應用在各種負載條件下的高可用性和性能。雖然目前 HPA 已相當成熟，但仍有提升空間，如對更複雜的擴展策略的支持，以及更細粒度的資源管理。未來，隨著技術的發展，我們可以期待 HPA 將變得更加智能和靈活。\n📚References Horizontal Pod Autoscaling | Kubernetes ","wordCount":"236","inLanguage":"en","image":"https://sz9751210.github.io/assets/k8s-hpa/cover.png","datePublished":"2024-01-03T16:09:00+08:00","dateModified":"2024-01-17T10:34:14+08:00","author":{"@type":"Person","name":"Alan"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://sz9751210.github.io/posts/k8s-hpa/"},"publisher":{"@type":"Organization","name":"艾倫的程式之旅","logo":{"@type":"ImageObject","url":"https://sz9751210.github.io/assets/profile/avatar.png"}}}</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8214206744217848" crossorigin=anonymous></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://sz9751210.github.io/ accesskey=h title="Alan's BLOG (Alt + H)"><img src=https://sz9751210.github.io/assets/profile/avatar.png alt aria-label=logo height=35>Alan's BLOG</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://sz9751210.github.io/archives/ title=archives><span>archives</span></a></li><li><a href=https://sz9751210.github.io/posts/ title=posts><span>posts</span></a></li><li><a href=https://sz9751210.github.io/tags/ title=tags><span>tags</span></a></li><li><a href=https://sz9751210.github.io/about/ title=about><span>about</span></a></li><li><a href=https://sz9751210.github.io/quote/ title=quote><span>quote</span></a></li><li><a href=https://sz9751210.github.io/search/ title="search (Alt + /)" accesskey=/><span>search</span></a></li></ul></nav></header><main class=main><article class=post><header class=post-header><div class=breadcrumbs><a href=https://sz9751210.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://sz9751210.github.io/posts/>Posts</a></div><h1 class=post-title>Kubernetes HPA：自動化應用擴展的藝術</h1><div class=post-description>k8s-hpa</div><div class=post-meta><span title="2024-01-03 16:09:00 +0800 CST">2024-01-03</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;236 words&nbsp;·&nbsp;Alan</div></header><figure class=entry-cover1><img loading=lazy src=https://sz9751210.github.io/assets/k8s-hpa/cover.png alt></figure><aside id=toc-container class="toc-container wide"><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%bc%95%e8%a8%80 aria-label=引言>引言</a></li><li><a href=#horizontal-pod-autoscaler-hpa-%e7%b0%a1%e4%bb%8b aria-label="Horizontal Pod Autoscaler (HPA) 簡介">Horizontal Pod Autoscaler (HPA) 簡介</a><ul><li><a href=#%e5%ae%9a%e7%be%a9 aria-label=定義>定義</a></li><li><a href=#%e5%b7%a5%e4%bd%9c%e5%8e%9f%e7%90%86 aria-label=工作原理>工作原理</a></li><li><a href=#%e4%b8%bb%e8%a6%81%e7%89%b9%e9%bb%9e aria-label=主要特點>主要特點</a></li></ul></li><li><a href=#hpa%e7%9a%84%e9%81%8b%e4%bd%9c%e6%a9%9f%e5%88%b6 aria-label=HPA的運作機制>HPA的運作機制</a><ul><li><a href=#%e6%8c%87%e6%a8%99%e9%a1%9e%e5%9e%8b aria-label=指標類型>指標類型</a></li><li><a href=#%e6%b1%ba%e7%ad%96%e9%81%8e%e7%a8%8b aria-label=決策過程>決策過程</a></li><li><a href=#%e6%93%b4%e5%b1%95%e7%ad%96%e7%95%a5 aria-label=擴展策略>擴展策略</a></li></ul></li><li><a href=#hpa%e7%9a%84%e8%a8%ad%e7%bd%ae%e8%88%87%e9%85%8d%e7%bd%ae aria-label=HPA的設置與配置>HPA的設置與配置</a><ul><li><a href=#%e5%9f%ba%e6%9c%ac%e8%a8%ad%e7%bd%ae%e6%ad%a5%e9%a9%9f aria-label=基本設置步驟>基本設置步驟</a></li><li><a href=#%e9%85%8d%e7%bd%ae%e9%81%b8%e9%a0%85 aria-label=配置選項>配置選項</a></li><li><a href=#%e5%b8%b8%e8%a6%8b%e5%95%8f%e9%a1%8c%e5%92%8c%e6%9c%80%e4%bd%b3%e5%af%a6%e8%b8%90 aria-label=常見問題和最佳實踐>常見問題和最佳實踐</a></li></ul></li><li><a href=#hpa%e7%9a%84%e5%af%a6%e9%9a%9b%e6%87%89%e7%94%a8%e6%a1%88%e4%be%8b aria-label=HPA的實際應用案例>HPA的實際應用案例</a><ul><li><a href=#%e6%a1%88%e4%be%8b%e7%a0%94%e7%a9%b6 aria-label=案例研究>案例研究</a></li><li><a href=#%e6%95%88%e7%9b%8a%e5%88%86%e6%9e%90 aria-label=效益分析>效益分析</a></li></ul></li><li><a href=#%e5%b0%8f%e7%b5%90 aria-label=小結>小結</a></li><li><a href=#references aria-label=📚References>📚References</a></li></ul></div></details></div></aside><script>let activeElement,elements;window.addEventListener("DOMContentLoaded",function(){checkTocPosition(),elements=document.querySelectorAll("h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]"),activeElement=elements[0];const t=encodeURI(activeElement.getAttribute("id")).toLowerCase();document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active")},!1),window.addEventListener("resize",function(){checkTocPosition()},!1),window.addEventListener("scroll",()=>{activeElement=Array.from(elements).find(e=>{if(getOffsetTop(e)-window.pageYOffset>0&&getOffsetTop(e)-window.pageYOffset<window.innerHeight/2)return e})||activeElement,elements.forEach(e=>{const t=encodeURI(e.getAttribute("id")).toLowerCase();e===activeElement?document.querySelector(`.inner ul li a[href="#${t}"]`).classList.add("active"):document.querySelector(`.inner ul li a[href="#${t}"]`).classList.remove("active")})},!1);const main=parseInt(getComputedStyle(document.body).getPropertyValue("--article-width"),10),toc=parseInt(getComputedStyle(document.body).getPropertyValue("--toc-width"),10),gap=parseInt(getComputedStyle(document.body).getPropertyValue("--gap"),10);function checkTocPosition(){const e=document.body.scrollWidth;e-main-toc*2-gap*4>0?document.getElementById("toc-container").classList.add("wide"):document.getElementById("toc-container").classList.remove("wide")}function getOffsetTop(e){if(!e.getClientRects().length)return 0;let t=e.getBoundingClientRect(),n=e.ownerDocument.defaultView;return t.top+n.pageYOffset}</script><div class=post-content><h2 id=引言>引言<a hidden class=anchor aria-hidden=true href=#引言>#</a></h2><p>在當今的技術世界中，<strong>Kubernetes</strong> 已成為容器化應用的領導平台。作為一個高效的容器編排系統，它不僅管理著容器的部署和擴展，還提供了必要的自動化支持，以保證應用的高可用性和性能。在這個框架中，自動擴展功能起著至關重要的作用，特別是在面對不斷變化的負載和需求時。</p><p>隨著企業和開發者尋求更靈活、更高效的資源管理方式，<strong>Kubernetes Horizontal Pod Autoscaler (HPA)</strong> 應運而生。HPA 是 Kubernetes 內建的一項機能，旨在自動調整 Pod 的數量以滿足當前的性能需求。這不僅提高了資源的使用效率，也確保了應用的穩定運行，特別是在高流量或不可預測的使用模式下。</p><p>HPA 的核心價值在於其能夠基於實際的性能指標（如 CPU 利用率或自定義指標）動態調整 Pod 的數量。這種彈性的擴展機制意味著系統能夠自動應對突發流量，同時在需求降低時縮減資源，從而達到成本效益的最佳平衡。</p><h2 id=horizontal-pod-autoscaler-hpa-簡介>Horizontal Pod Autoscaler (HPA) 簡介<a hidden class=anchor aria-hidden=true href=#horizontal-pod-autoscaler-hpa-簡介>#</a></h2><h3 id=定義>定義<a hidden class=anchor aria-hidden=true href=#定義>#</a></h3><p>Kubernetes Horizontal Pod Autoscaler，簡稱 HPA，是一種在 Kubernetes 環境中自動調整 Pod 數量的機制。它根據指定的指標（如 CPU 利用率、記憶體使用量或自定義指標）動態增減 Pod 的數量，以應對應用的負載變化。</p><h3 id=工作原理>工作原理<a hidden class=anchor aria-hidden=true href=#工作原理>#</a></h3><p>當 HPA 被部署到 Kubernetes 集群時，它會定期（預設 15 秒）檢查所指定指標的當前值，來判斷是否需要擴展或縮減 Pod 的數量。當這些指標超過或低於預設的閾值時，HPA 會自動增加或減少 Pod 的數量，從而確保應用平穩運行。</p><h3 id=主要特點>主要特點<a hidden class=anchor aria-hidden=true href=#主要特點>#</a></h3><ul><li><strong>動態擴展</strong>：根據實時的系統負載進行擴展或縮減。</li><li><strong>靈活配置</strong>：支持多種指標，包括標準指標和自定義指標。</li><li><strong>成本效益</strong>：通過優化資源使用，減少不必要的開支。</li></ul><h2 id=hpa的運作機制>HPA的運作機制<a hidden class=anchor aria-hidden=true href=#hpa的運作機制>#</a></h2><h3 id=指標類型>指標類型<a hidden class=anchor aria-hidden=true href=#指標類型>#</a></h3><ul><li><strong>CPU 利用率</strong>：最常用的自動擴展指標。</li><li><strong>自定義指標</strong>：根據特定的業務需求或性能指標進行擴展。</li></ul><h3 id=決策過程>決策過程<a hidden class=anchor aria-hidden=true href=#決策過程>#</a></h3><p>HPA 決策過程基於預定的指標和閾值。當指標超過或低於設定的閾值時，HPA 會觸發擴展或縮減的操作。</p><h3 id=擴展策略>擴展策略<a hidden class=anchor aria-hidden=true href=#擴展策略>#</a></h3><ul><li><strong>線性擴展</strong>：根據指標的增減比例進行擴展或縮減。</li><li><strong>自定義策略</strong>：可以根據特定需求定制擴展策略。</li></ul><h2 id=hpa的設置與配置>HPA的設置與配置<a hidden class=anchor aria-hidden=true href=#hpa的設置與配置>#</a></h2><h3 id=基本設置步驟>基本設置步驟<a hidden class=anchor aria-hidden=true href=#基本設置步驟>#</a></h3><ol><li><strong>確定指標</strong>：選擇用於自動擴展的指標，如 CPU 利用率或自定義指標。</li><li><strong>部署 Metrics Server</strong>：安裝 Metrics Server 以提供必要的性能指標數據。</li><li><strong>創建 HPA 資源</strong>：通過 Kubernetes 的 YAML 文件定義 HPA 資源，指定目標 Pod 和相應的擴展指標。
以下是一個使用 YAML 定義的 HPA 實例：</li></ol><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>   </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>autoscaling/v2beta2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>HorizontalPodAutoscaler</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp-hpa</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>   </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>scaleTargetRef</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>myapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>minReplicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>maxReplicas</span><span class=p>:</span><span class=w> </span><span class=m>10</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span><span class=nt>metrics</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>     </span>- <span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Resource</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>       </span><span class=nt>resource</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cpu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>         </span><span class=nt>target</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Utilization</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>           </span><span class=nt>averageUtilization</span><span class=p>:</span><span class=w> </span><span class=m>50</span><span class=w>
</span></span></span></code></pre></div><p>在這個例子中，如果 <code>myapp</code> 的平均 CPU 使用率超過 50%，HPA 會自動增加 Pod 的數量，最多到 10 個副本。當 CPU 使用率下降時，HPA 則會減少 Pod 的數量，但不會少於 1 個副本。</p><ol start=4><li><strong>配置閾值</strong>：設置自動擴展的觸發閾值，如 CPU 利用率的最大和最小值。</li></ol><h3 id=配置選項>配置選項<a hidden class=anchor aria-hidden=true href=#配置選項>#</a></h3><ul><li><strong>最小和最大 Pod 數</strong>：設定 Pod 的數量範圍。</li><li><strong>擴展冷卻期</strong>：設定在進行下一次擴展之前的等待時間。</li><li><strong>自定義指標</strong>：支持根據業務特定指標進行擴展。</li></ul><h3 id=常見問題和最佳實踐>常見問題和最佳實踐<a hidden class=anchor aria-hidden=true href=#常見問題和最佳實踐>#</a></h3><ul><li>確保 Metrics Server 正常運行。</li><li>避免設置過敏感的擴展閾值，以免造成頻繁的擴展操作。</li><li>根據應用需求和性能數據調整配置。</li></ul><h2 id=hpa的實際應用案例>HPA的實際應用案例<a hidden class=anchor aria-hidden=true href=#hpa的實際應用案例>#</a></h2><p>在正式環境中，HPA 能夠為應用帶來顯著的彈性和效率提升。例如，電商網站在促銷期間可能會經歷流量高峰，這時 HPA 可以自動擴展服務以處理增加的請求。當促銷結束，流量減少，HPA 可以相應減少 Pod 的數量，節省資源。</p><ol><li><p>初始狀態（1 個 Pod 副本）:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get po
</span></span><span class=line><span class=cl>NAME                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>myapp-56f87c895f-9t7xx    1/1     Running   0          10m
</span></span></code></pre></div></li><li><p>流量增加後，HPA 自動擴展 Pod（例如增至 3 個副本）:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>kubectl get po
</span></span><span class=line><span class=cl>NAME                      READY   STATUS    RESTARTS   AGE
</span></span><span class=line><span class=cl>myapp-56f87c895f-9t7xx    1/1     Running   0          12m
</span></span><span class=line><span class=cl>myapp-56f87c895f-j7hk5    1/1     Running   0           2m
</span></span><span class=line><span class=cl>myapp-56f87c895f-v9g8n    1/1     Running   0           2m
</span></span></code></pre></div></li></ol><h3 id=案例研究>案例研究<a hidden class=anchor aria-hidden=true href=#案例研究>#</a></h3><ol><li><strong>電商平台</strong>：在促銷期間，根據流量自動調整服務器資源。</li><li><strong>社交媒體應用</strong>：依據用戶活動高峰期動態調節後端服務。</li></ol><h3 id=效益分析>效益分析<a hidden class=anchor aria-hidden=true href=#效益分析>#</a></h3><ul><li><strong>成本效益</strong>：通過僅在需要時增加資源，減少不必要的資源浪費。</li><li><strong>提升性能</strong>：確保應用在高負載時仍能保持穩定性能。</li><li><strong>自動化運維</strong>：減少人工介入，提高運維效率。</li></ul><h2 id=小結>小結<a hidden class=anchor aria-hidden=true href=#小結>#</a></h2><p>Kubernetes HPA 是現代雲原生架構中不可或缺的一部分，它通過智能化的自動擴展機制，確保了應用在各種負載條件下的高可用性和性能。雖然目前 HPA 已相當成熟，但仍有提升空間，如對更複雜的擴展策略的支持，以及更細粒度的資源管理。未來，隨著技術的發展，我們可以期待 HPA 將變得更加智能和靈活。</p><h2 id=references>📚References<a hidden class=anchor aria-hidden=true href=#references>#</a></h2><ul><li><a href=https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/>Horizontal Pod Autoscaling | Kubernetes</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://sz9751210.github.io/tags/k8s/>k8s</a></li><li><a href=https://sz9751210.github.io/tags/devops/>devops</a></li></ul><div class=post-meta>更新於: 2024-01-17</div><nav class=paginav><a class=prev href=https://sz9751210.github.io/posts/monitor-ssl/><span class=title>« Prev</span><br><span>自動化SSL憑證監控與到期通知系統</span>
</a><a class=next href=https://sz9751210.github.io/posts/tf-cloud-armor/><span class=title>Next »</span><br><span>使用 Terraform 在 GCP 上建立 Cloud Armor</span></a></nav><script src=https://utteranc.es/client.js repo=sz9751210/utterances issue-term=title theme=github-dark crossorigin=anonymous async></script><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on twitter" href="https://twitter.com/intent/tweet/?text=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93&amp;url=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f&amp;hashtags=k8s%2cdevops"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f&amp;title=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93&amp;summary=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93&amp;source=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f&title=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on whatsapp" href="https://api.whatsapp.com/send?text=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93%20-%20https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Kubernetes HPA：自動化應用擴展的藝術 on telegram" href="https://telegram.me/share/url?text=Kubernetes%20HPA%ef%bc%9a%e8%87%aa%e5%8b%95%e5%8c%96%e6%87%89%e7%94%a8%e6%93%b4%e5%b1%95%e7%9a%84%e8%97%9d%e8%a1%93&amp;url=https%3a%2f%2fsz9751210.github.io%2fposts%2fk8s-hpa%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://sz9751210.github.io/>艾倫的程式之旅</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let detail=document.getElementsByClassName("details");details=[].slice.call(detail);for(let e=0;e<details.length;e++){let t=details[e];const n=t.getElementsByClassName("details-summary")[0];n&&n.addEventListener("click",()=>{t.classList.toggle("open")},!1)}</script><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>